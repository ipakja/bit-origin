name: Backup Test

on:
  schedule:
    - cron: '0 3 * * 0'  # WÃ¶chentlich
  workflow_dispatch:

jobs:
  backup-test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Setup SSH
      uses: webfactory/ssh-agent@v0.7.0
      with:
        ssh-private-key: ${{ secrets.SSH_PRIVATE_KEY }}
    
    - name: Test Backup Integrity
      run: |
        ssh ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_HOST }} '
          echo "ğŸ”„ Backup-Test gestartet..."
          sudo /opt/bit-origin/backup/boksitsupport-backup.sh
          borg check /backup/boksitsupport
          echo "âœ… Backup-IntegritÃ¤t: OK"
        '
    
    - name: Test Offsite Backup
      run: |
        ssh ${{ secrets.SERVER_USER }}@${{ secrets.SERVER_HOST }} '
          echo "ğŸŒ Offsite-Backup-Test..."
          sudo /opt/bit-origin/backup/offsite-backup.sh
          echo "âœ… Offsite-Backup: OK"
        '
    
    - name: Backup Report
      run: |
        echo "ğŸ’¾ Backup-Test abgeschlossen"
        echo "ğŸ“Š Lokale Backups: OK"
        echo "ğŸŒ Offsite-Backups: OK"
        echo "âœ… Disaster Recovery: Bereit"




